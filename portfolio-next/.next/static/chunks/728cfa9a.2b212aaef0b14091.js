"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[102],{4840:function(e,t,r){r.d(t,{Q:function(){return ek},k:function(){return el}});var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function i(e,t,r,n){return new(r||(r=Promise))(function(a,s){function i(e){try{o(n.next(e))}catch(t){s(t)}}function u(e){try{o(n.throw(e))}catch(t){s(t)}}function o(e){var t;e.done?a(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(i,u)}o((n=n.apply(e,t||[])).next())})}function u(e,t){var r,n,a,s,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(u){s=[6,u],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function o(e){return this instanceof o?(this.v=e,this):new o(e)}function c(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(e,t||[]),s=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(e){a[e]&&(n[e]=function(t){return new Promise(function(r,n){s.push([e,t,r,n])>1||u(e,t)})})}function u(e,t){try{var r;(r=a[e](t)).value instanceof o?Promise.resolve(r.value.v).then(c,l):f(s[0][2],r)}catch(n){f(s[0][3],n)}}function c(e){u("next",e)}function l(e){u("throw",e)}function f(e,t){e(t),s.shift(),s.length&&u(s[0][0],s[0][1])}}function l(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,a){!function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)}(n,a,(t=e[r](t)).done,t.value)})}}}var f=function(){function e(e,t,r){this.allowBoost=!1,this.string=e,this.marks=t,this.index=0,this.parseOptions=r}return e.prototype.hasMark=function(e){return void 0===e&&(e=0),this.index+e<this.marks.length},e.prototype.getMark=function(e){return void 0===e&&(e=0),this.marks[this.index+e]},e.prototype.shift=function(){this.index+=1},e.prototype.process=function(e){var t=this.marks[this.index];this.shift();var r=e[t.name];if(!r)throw Error("Unknown handler: ".concat(t.name));return r.call(e,this,t)},e.prototype.processString=function(){return this.shift(),this.processStringEnd()},e.prototype.processStringEnd=function(){var e=this.marks[this.index-1],t=this.marks[this.index];return this.shift(),this.string.slice(e.position,t.position)},e.prototype.slice=function(e){var t=this.marks[this.index].position;return this.string.slice(t,t+e)},e}(),p=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|([-+]\d{2}:\d{2}))$/;function h(e,t){for(var r=e.toString();r.length<t;)r="0".concat(r);return r}var d=function(){function e(e){this.pattern=e,this.patternRe=function(e){for(var t=[],r=0,n=e.split(".");r<n.length;r++){var a=n[r];"*"===a?t.push("[^.]+"):"**"===a?t.push(".*"):t.push(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))}return RegExp("^".concat(t.join("."),"$"))}(e)}return e.prototype.matches=function(e){return this.patternRe.test(e)},e.prototype.toJSON=function(){return this.pattern},e}(),y=function(){function e(e){this.type="stream",this.generator=e,this.ticker=null,this.isDone=!1,this.data=[]}return e.prototype.isArray=function(){return!0},e.prototype.get=function(){var e,t;return i(this,void 0,void 0,function(){var r,n,a,s,i,o;return u(this,function(u){switch(u.label){case 0:r=[],u.label=1;case 1:u.trys.push([1,7,8,13]),n=l(this),u.label=2;case 2:return[4,n.next()];case 3:if((a=u.sent()).done)return[3,6];return s=a.value,o=(i=r).push,[4,s.get()];case 4:o.apply(i,[u.sent()]),u.label=5;case 5:return[3,2];case 6:return[3,13];case 7:return e={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(a&&!a.done&&(t=n.return)))return[3,10];return[4,t.call(n)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(e)throw e.error;return[7];case 12:return[7];case 13:return[2,r]}})})},e.prototype[Symbol.asyncIterator]=function(){return c(this,arguments,function(){var e;return u(this,function(t){switch(t.label){case 0:e=0,t.label=1;case 1:t.label=2;case 2:if(!(e<this.data.length))return[3,6];return[4,o(this.data[e])];case 3:return[4,t.sent()];case 4:t.sent(),t.label=5;case 5:return e++,[3,2];case 6:if(!this.isDone)return[3,8];return[4,o(void 0)];case 7:return[2,t.sent()];case 8:return[4,o(this._nextTick())];case 9:return t.sent(),[3,1];case 10:return[2]}})})},e.prototype._nextTick=function(){var e,t=this;if(this.ticker)return this.ticker;var r=function(){t.ticker=new Promise(function(t){e=t})},n=function(){e(),r()};return r(),i(t,void 0,void 0,function(){var e,t,r,a,s;return u(this,function(i){switch(i.label){case 0:i.trys.push([0,5,6,11]),e=l(this.generator()),i.label=1;case 1:return[4,e.next()];case 2:if((t=i.sent()).done)return[3,4];r=t.value,this.data.push(r),n(),i.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a={error:i.sent()},[3,11];case 6:if(i.trys.push([6,,9,10]),!(t&&!t.done&&(s=e.return)))return[3,8];return[4,s.call(e)];case 7:i.sent(),i.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return this.isDone=!0,n(),[2]}})}),this.ticker},e}(),b=function(){function e(e,t){this.data=e,this.type=t}return e.prototype.isArray=function(){return"array"===this.type},e.prototype.get=function(){return i(this,void 0,void 0,function(){return u(this,function(e){return[2,this.data]})})},e.prototype[Symbol.asyncIterator]=function(){if(Array.isArray(this.data))return function(e){var t,r;return u(this,function(n){switch(n.label){case 0:t=0,r=e,n.label=1;case 1:if(!(t<r.length))return[3,4];return[4,E(r[t])];case 2:n.sent(),n.label=3;case 3:return t++,[3,1];case 4:return[2]}})}(this.data);throw Error("Cannot iterate over: ".concat(this.type))},e}(),v=new b(null,"null"),m=new b(!0,"boolean"),w=new b(!1,"boolean"),g=function(){function e(e){this.date=e}return e.parseToValue=function(t){var r=p.test(t)?new Date(t):null;return r?new b(new e(r),"datetime"):v},e.prototype.equals=function(e){return this.date.getTime()==e.date.getTime()},e.prototype.add=function(t){var r=new Date(this.date.getTime());return r.setTime(r.getTime()+1e3*t),new e(r)},e.prototype.difference=function(e){return(this.date.getTime()-e.date.getTime())/1e3},e.prototype.compareTo=function(e){return this.date.getTime()-e.date.getTime()},e.prototype.toString=function(){var e,t,r,n,a,s,i,u,o;return t=h((e=this.date).getUTCFullYear(),4),r=h(e.getUTCMonth()+1,2),n=h(e.getUTCDate(),2),a=h(e.getUTCHours(),2),s=h(e.getUTCMinutes(),2),i=h(e.getUTCSeconds(),2),u="",0!=(o=e.getMilliseconds())&&(u=".".concat(h(o,3))),"".concat(t,"-").concat(r,"-").concat(n,"T").concat(a,":").concat(s,":").concat(i).concat(u,"Z")},e.prototype.toJSON=function(){return this.toString()},e}();function k(e){return Number.isFinite(e)?new b(e,"number"):v}function x(e){return new b(e,"string")}function _(e){return new b(e,"datetime")}function E(e){return e&&"function"==typeof e.next?new y(function(){return c(this,arguments,function(){var t,r,n,a;return u(this,function(s){switch(s.label){case 0:s.trys.push([0,7,8,13]),t=l(e),s.label=1;case 1:return[4,o(t.next())];case 2:if((r=s.sent()).done)return[3,6];return[4,o(E(r.value))];case 3:return[4,s.sent()];case 4:s.sent(),s.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return n={error:s.sent()},[3,13];case 8:if(s.trys.push([8,,11,12]),!(r&&!r.done&&(a=t.return)))return[3,10];return[4,o(a.call(t))];case 9:s.sent(),s.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2]}})})}):null==e?v:new b(e,A(e))}function A(e){return null==e?"null":Array.isArray(e)?"array":e instanceof d?"path":e instanceof g?"datetime":typeof e}var S={datetime:1,number:2,string:3,boolean:4};function j(e,t){var r=A(e);if(r!==A(t))return null;switch(r){case"number":case"boolean":return e-t;case"string":if(e<t)return -1;if(e>t)return 1;return 0;case"datetime":return e.compareTo(t);default:return null}}var O=/([^!@#$%^&*(),\\/?";:{}|[\]+<>\s-])+/g,I=/([^!@#$%^&(),\\/?";:{}|[\]+<>\s-])+/g,C=/(\b\.+|\.+\b)/g;function T(e){return e.replace(C,"").match(O)||[]}function M(e){return(e.replace(C,"").match(I)||[]).map(function(e){return RegExp("^".concat(e.slice(0,1024).replace(/\*/g,".*"),"$"),"i")})}function P(e,t){var r,n,a,s;return i(this,void 0,void 0,function(){var i,o;return u(this,function(u){switch(u.label){case 0:if("string"===e.type)return t(e.data),[2,!0];if(!e.isArray())return[3,13];i=!0,u.label=1;case 1:u.trys.push([1,6,7,12]),r=l(e),u.label=2;case 2:return[4,r.next()];case 3:if((n=u.sent()).done)return[3,5];"string"===(o=n.value).type?t(o.data):i=!1,u.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return a={error:u.sent()},[3,12];case 7:if(u.trys.push([7,,10,11]),!(n&&!n.done&&(s=r.return)))return[3,9];return[4,s.call(r)];case 8:u.sent(),u.label=9;case 9:return[3,11];case 10:if(a)throw a.error;return[7];case 11:return[7];case 12:return[2,i];case 13:return[2,!1]}})})}function N(e){if("string"!=typeof e._type)return null;var t=e.children;if(!Array.isArray(t))return null;for(var r="",n=0;n<t.length;n++){var a=t[n];a&&"object"==typeof a&&"string"==typeof a._type&&"span"===a._type&&"string"==typeof a.text&&(r+=a.text)}return r}var U={};U.anywhere=function(){return i(this,void 0,void 0,function(){return u(this,function(e){throw Error("not implemented")})})},U.anywhere.arity=1,U.coalesce=function(e,t,r){return i(this,void 0,void 0,function(){var n,a,s;return u(this,function(i){switch(i.label){case 0:n=0,a=e,i.label=1;case 1:if(!(n<a.length))return[3,4];return[4,r(a[n],t)];case 2:if("null"!==(s=i.sent()).type)return[2,s];i.label=3;case 3:return n++,[3,1];case 4:return[2,v]}})})},U.count=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if(!(s=u.sent()).isArray())return[2,v];i=0,u.label=2;case 2:u.trys.push([2,7,8,13]),o=l(s),u.label=3;case 3:return[4,o.next()];case 4:if((c=u.sent()).done)return[3,6];c.value,i++,u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(c&&!c.done&&(a=o.return)))return[3,10];return[4,a.call(o)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,k(i)]}})})},U.count.arity=1,U.dateTime=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:if("datetime"===(n=a.sent()).type)return[2,n];if("string"!==n.type)return[2,v];return[2,g.parseToValue(n.data)]}})})},U.dateTime.arity=1,U.defined=function(e,t,r){return i(this,void 0,void 0,function(){return u(this,function(n){switch(n.label){case 0:return[4,r(e[0],t)];case 1:return[2,"null"===n.sent().type?w:m]}})})},U.defined.arity=1,U.identity=function(e,t){return i(this,void 0,void 0,function(){return u(this,function(e){return[2,x(t.context.identity)]})})},U.identity.arity=0,U.length=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if("string"===(s=u.sent()).type)return[2,k(function(e){for(var t=0,r=0;r<e.length;r++){var n=e.charCodeAt(r);(!(n>=55296)||!(n<=56319))&&t++}return t}(s.data))];if(!s.isArray())return[3,14];i=0,u.label=2;case 2:u.trys.push([2,7,8,13]),o=l(s),u.label=3;case 3:return[4,o.next()];case 4:if((c=u.sent()).done)return[3,6];c.value,i++,u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(c&&!c.done&&(a=o.return)))return[3,10];return[4,a.call(o)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,k(i)];case 14:return[2,v]}})})},U.length.arity=1,U.path=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:var s;if("string"!==(n=a.sent()).type)return[2,v];return[2,(s=new d(n.data),new b(s,"path"))]}})})},U.path.arity=1,U.string=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:switch((n=a.sent()).type){case"number":case"string":case"boolean":case"datetime":return[2,x("".concat(n.data))];default:return[2,v]}return[2]}})})},U.string.arity=1,U.references=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f,p,h;return u(this,function(u){switch(u.label){case 0:s=new Set,i=0,o=e,u.label=1;case 1:if(!(i<o.length))return[3,16];return[4,r(o[i],t)];case 2:if("string"!==(c=u.sent()).type)return[3,3];return s.add(c.data),[3,15];case 3:if(!c.isArray())return[3,15];u.label=4;case 4:u.trys.push([4,9,10,15]),n=void 0,f=l(c),u.label=5;case 5:return[4,f.next()];case 6:if((p=u.sent()).done)return[3,8];"string"===(h=p.value).type&&s.add(h.data),u.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return n={error:u.sent()},[3,15];case 10:if(u.trys.push([10,,13,14]),!(p&&!p.done&&(a=f.return)))return[3,12];return[4,a.call(f)];case 11:u.sent(),u.label=12;case 12:return[3,14];case 13:if(n)throw n.error;return[7];case 14:return[7];case 15:return i++,[3,1];case 16:if(0===s.size)return[2,w];return[4,t.value.get()];case 17:return[2,!function e(t,r){switch(A(t)){case"array":for(var n=0;n<t.length;n++){var a=t[n];if(e(a,r))return!0}break;case"object":if(t._ref)return r.has(t._ref);for(var s=0,i=Object.values(t);s<i.length;s++){var a=i[s];if(e(a,r))return!0}}return!1}(u.sent(),s)?w:m]}})})},U.references.arity=function(e){return e>=1},U.round=function(e,t,r){return i(this,void 0,void 0,function(){var n,a,s,i;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if("number"!==(n=u.sent()).type)return[2,v];if(a=n.data,s=0,2!==e.length)return[3,3];return[4,r(e[1],t)];case 2:if("number"!==(i=u.sent()).type||i.data<0||!Number.isInteger(i.data))return[2,v];s=i.data,u.label=3;case 3:if(0===s){if(a<0)return[2,k(-Math.round(-a))];return[2,k(Math.round(a))]}return[2,k(Number(a.toFixed(s)))]}})})},U.round.arity=function(e){return e>=1&&e<=2},U.now=function(e,t){return i(this,void 0,void 0,function(){return u(this,function(e){return[2,x(t.context.timestamp.toISOString())]})})},U.now.arity=0,U.boost=function(){return i(this,void 0,void 0,function(){return u(this,function(e){throw Error("unexpected boost call")})})},U.boost.arity=2;var V={};V.lower=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:if("string"!==(n=a.sent()).type)return[2,v];return[2,x(n.data.toLowerCase())]}})})},V.lower.arity=1,V.upper=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:if("string"!==(n=a.sent()).type)return[2,v];return[2,x(n.data.toUpperCase())]}})})},V.upper.arity=1,V.split=function(e,t,r){return i(this,void 0,void 0,function(){var n,a;return u(this,function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:if("string"!==(n=s.sent()).type)return[2,v];return[4,r(e[1],t)];case 2:if("string"!==(a=s.sent()).type)return[2,v];if(0===n.data.length)return[2,E([])];if(0===a.data.length)return[2,E(Array.from(n.data))];return[2,E(n.data.split(a.data))]}})})},V.split.arity=2,U.lower=V.lower,U.upper=V.upper,V.startsWith=function(e,t,r){return i(this,void 0,void 0,function(){var n,a;return u(this,function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:if("string"!==(n=s.sent()).type)return[2,v];return[4,r(e[1],t)];case 2:if("string"!==(a=s.sent()).type)return[2,v];return[2,n.data.startsWith(a.data)?m:w]}})})},V.startsWith.arity=2;var D={};D.join=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f,p,h;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if(!(s=u.sent()).isArray())return[2,v];return[4,r(e[1],t)];case 2:if("string"!==(i=u.sent()).type)return[2,v];o="",c=!1,u.label=3;case 3:u.trys.push([3,8,9,14]),f=l(s),u.label=4;case 4:return[4,f.next()];case 5:if((p=u.sent()).done)return[3,7];switch(h=p.value,c&&(o+=i.data),h.type){case"number":case"string":case"boolean":case"datetime":o+="".concat(h.data);break;default:return[2,v]}c=!0,u.label=6;case 6:return[3,4];case 7:return[3,14];case 8:return n={error:u.sent()},[3,14];case 9:if(u.trys.push([9,,12,13]),!(p&&!p.done&&(a=f.return)))return[3,11];return[4,a.call(f)];case 10:u.sent(),u.label=11;case 11:return[3,13];case 12:if(n)throw n.error;return[7];case 13:return[7];case 14:return[2,E(o)]}})})},D.join.arity=2,D.compact=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:if(!(n=a.sent()).isArray())return[2,v];return[2,new y(function(){return c(this,arguments,function(){var e,t,r,a,s;return u(this,function(i){switch(i.label){case 0:i.trys.push([0,7,8,13]),e=l(n),i.label=1;case 1:return[4,o(e.next())];case 2:if((t=i.sent()).done)return[3,6];if(!("null"!==(r=t.value).type))return[3,5];return[4,o(r)];case 3:return[4,i.sent()];case 4:i.sent(),i.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return a={error:i.sent()},[3,13];case 8:if(i.trys.push([8,,11,12]),!(t&&!t.done&&(s=e.return)))return[3,10];return[4,o(s.call(e))];case 9:i.sent(),i.label=10;case 10:return[3,12];case 11:if(a)throw a.error;return[7];case 12:return[7];case 13:return[2]}})})})]}})})},D.compact.arity=1,D.unique=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:if(!(n=a.sent()).isArray())return[2,v];return[2,new y(function(){return c(this,arguments,function(){var e,t,r,a,s,i,c;return u(this,function(s){switch(s.label){case 0:e=new Set,s.label=1;case 1:s.trys.push([1,13,14,19]),t=l(n),s.label=2;case 2:return[4,o(t.next())];case 3:if((r=s.sent()).done)return[3,12];switch((a=r.value).type){case"number":case"string":case"boolean":case"datetime":return[3,4]}return[3,8];case 4:if(e.has(a.data))return[3,7];return e.add(a.data),[4,o(a)];case 5:return[4,s.sent()];case 6:s.sent(),s.label=7;case 7:return[3,11];case 8:return[4,o(a)];case 9:return[4,s.sent()];case 10:s.sent(),s.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return i={error:s.sent()},[3,19];case 14:if(s.trys.push([14,,17,18]),!(r&&!r.done&&(c=t.return)))return[3,16];return[4,o(c.call(t))];case 15:s.sent(),s.label=16;case 16:return[3,18];case 17:if(i)throw i.error;return[7];case 18:return[7];case 19:return[2]}})})})]}})})},D.unique.arity=1;var F={};F.text=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:return[4,function(e){return i(this,void 0,void 0,function(){var t;return u(this,function(r){switch(r.label){case 0:if("object"!==e.type)return[3,1];return[2,N(e.data)];case 1:if(!e.isArray())return[3,3];return[4,function e(t,r){var n,a,s,o;return void 0===r&&(r=[]),i(this,void 0,void 0,function(){var i,c;return u(this,function(u){switch(u.label){case 0:u.trys.push([0,7,8,13]),n=l(t),u.label=1;case 1:return[4,n.next()];case 2:if((a=u.sent()).done)return[3,6];if("object"!==(i=a.value).type)return[3,3];return null!==(c=N(i.data))&&r.push(c),[3,5];case 3:if(!i.isArray())return[3,5];return[4,e(i,r)];case 4:u.sent(),u.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return s={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(a&&!a.done&&(o=n.return)))return[3,10];return[4,o.call(n)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(s)throw s.error;return[7];case 12:return[7];case 13:return[2,r]}})})}(e)];case 2:if((t=r.sent()).length>0)return[2,t.join("\n\n")];r.label=3;case 3:return[2,null]}})})}(a.sent())];case 2:if(null===(n=a.sent()))return[2,v];return[2,x(n)]}})})},F.text.arity=1;var q={};q.projectId=function(e,t){return i(this,void 0,void 0,function(){return u(this,function(e){return t.context.sanity?[2,x(t.context.sanity.projectId)]:[2,v]})})},q.dataset=function(e,t){return i(this,void 0,void 0,function(){return u(this,function(e){return t.context.sanity?[2,x(t.context.sanity.dataset)]:[2,v]})})};var G={};G.order=function(e,t,r,n){var a,s,o,c;return i(this,void 0,void 0,function(){var i,f,p,h,d,y,b,m,w,g,k,x,_,O,I;return u(this,function(u){switch(u.label){case 0:return[4,!0];case 1:if(u.sent(),!e.isArray())return[2,v];for(h=0,i=[],f=[],p=0;h<t.length;h++)d=t[h],y="asc","Desc"===d.type?(y="desc",d=d.base):"Asc"===d.type&&(d=d.base),i.push(d),f.push(y),p++;b=[],m=0,u.label=2;case 2:u.trys.push([2,13,14,19]),a=l(e),u.label=3;case 3:return[4,a.next()];case 4:if((s=u.sent()).done)return[3,12];return w=s.value,g=r.createNested(w),[4,w.get()];case 5:k=[u.sent(),m],x=0,u.label=6;case 6:if(!(x<p))return[3,10];return[4,n(i[x],g)];case 7:return _=u.sent(),I=(O=k).push,[4,_.get()];case 8:I.apply(O,[u.sent()]),u.label=9;case 9:return x++,[3,6];case 10:b.push(k),m++,u.label=11;case 11:return[3,3];case 12:return[3,19];case 13:return o={error:u.sent()},[3,19];case 14:if(u.trys.push([14,,17,18]),!(s&&!s.done&&(c=a.return)))return[3,16];return[4,c.call(a)];case 15:u.sent(),u.label=16;case 16:return[3,18];case 17:if(o)throw o.error;return[7];case 18:return[7];case 19:return b.sort(function(e,t){for(var r=0;r<p;r++){var n=function(e,t){var r=A(e),n=A(t),a=S[r]||100,s=S[n]||100;if(a!==s)return a-s;var i=j(e,t);return null===i&&(i=0),i}(e[r+2],t[r+2]);if("desc"===f[r]&&(n=-n),0!==n)return n}return e[1]-t[1]}),[2,E(b.map(function(e){return e[0]}))]}})})},G.order.arity=function(e){return e>=1},G.score=function(e,t,r,n){var a,s,o,c;return i(this,void 0,void 0,function(){var f,p,h,d,y,b,m,w,g,k,x,_;return u(this,function(A){switch(A.label){case 0:if(!e.isArray())return[2,v];f=[],p=[],A.label=1;case 1:A.trys.push([1,12,13,18]),a=l(e),A.label=2;case 2:return[4,a.next()];case 3:if((s=A.sent()).done)return[3,11];if(!("object"!==(h=s.value).type))return[3,5];return y=(d=f).push,[4,h.get()];case 4:return y.apply(d,[A.sent()]),[3,10];case 5:b=r.createNested(h),m="number"==typeof h.data._score?h.data._score:0,w=0,g=t,A.label=6;case 6:if(!(w<g.length))return[3,9];return k=g[w],x=m,[4,function e(t,r,n){return i(this,void 0,void 0,function(){var a,s,o,c,l,f;return u(this,function(o){switch(o.label){case 0:if("OpCall"===t.type&&"match"===t.op)return[2,function(e,t,r,n){return i(this,void 0,void 0,function(){var a,s,i,o,c,l,f,p;return u(this,function(u){switch(u.label){case 0:return[4,n(e,r)];case 1:return a=u.sent(),[4,n(t,r)];case 2:return s=u.sent(),i=[],o=[],[4,P(a,function(e){i=i.concat(T(e))})];case 3:return u.sent(),[4,P(s,function(e){o=o.concat(M(e))})];case 4:if(!u.sent()||0===i.length||0===o.length)return[2,0];for(f=0,c=0,l=function(e){var t=i.reduce(function(t,r){return t+(e.test(r)?1:0)},0);c+=2.2*t/(t+1.2)},p=o;f<p.length;f++)l(p[f]);return[2,c]}})})}(t.left,t.right,r,n)];if(!("FuncCall"===t.type&&"boost"===t.name))return[3,3];return[4,e(t.args[0],r,n)];case 1:return a=o.sent(),[4,n(t.args[1],r)];case 2:if("number"===(s=o.sent()).type&&a>0)return[2,a+s.data];return[2,0];case 3:switch(t.type){case"Or":return[3,4];case"And":return[3,7]}return[3,10];case 4:case 7:return[4,e(t.left,r,n)];case 5:case 8:return c=o.sent(),[4,e(t.right,r,n)];case 6:return[2,c+(l=o.sent())];case 9:if(l=o.sent(),0===c||0===l)return[2,0];return[2,c+l];case 10:return[4,n(t,r)];case 11:return[2,"boolean"===(f=o.sent()).type&&!0===f.data?1:0]}})})}(k,b,n)];case 7:m=x+A.sent(),A.label=8;case 8:return w++,[3,6];case 9:_=Object.assign({},h.data,{_score:m}),p.push(_),A.label=10;case 10:return[3,2];case 11:return[3,18];case 12:return o={error:A.sent()},[3,18];case 13:if(A.trys.push([13,,16,17]),!(s&&!s.done&&(c=a.return)))return[3,15];return[4,c.call(a)];case 14:A.sent(),A.label=15;case 15:return[3,17];case 16:if(o)throw o.error;return[7];case 17:return[7];case 18:return p.sort(function(e,t){return t._score-e._score}),[2,E(p)]}})})},G.score.arity=function(e){return e>=1};var $={};$.operation=function(e,t){return i(this,void 0,void 0,function(){var e,r;return u(this,function(n){return(e=null!==t.context.before,r=null!==t.context.after,e&&r)?[2,x("update")]:r?[2,x("create")]:e?[2,x("delete")]:[2,v]})})},$.changedAny=function(){throw Error("not implemented")},$.changedAny.arity=1,$.changedAny.mode="delta",$.changedOnly=function(){throw Error("not implemented")},$.changedOnly.arity=1,$.changedOnly.mode="delta";var B={};B.changedAny=function(){throw Error("not implemented")},B.changedAny.arity=3,B.changedOnly=function(){throw Error("not implemented")},B.changedOnly.arity=3;var H={};H.min=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if(!(s=u.sent()).isArray())return[2,v];i=void 0,u.label=2;case 2:u.trys.push([2,7,8,13]),o=l(s),u.label=3;case 3:return[4,o.next()];case 4:if((c=u.sent()).done)return[3,6];if("null"===(f=c.value).type)return[3,5];if("number"!==f.type)return[2,v];(void 0===i||f.data<i)&&(i=f.data),u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(c&&!c.done&&(a=o.return)))return[3,10];return[4,a.call(o)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,E(i)]}})})},H.min.arity=1,H.max=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if(!(s=u.sent()).isArray())return[2,v];i=void 0,u.label=2;case 2:u.trys.push([2,7,8,13]),o=l(s),u.label=3;case 3:return[4,o.next()];case 4:if((c=u.sent()).done)return[3,6];if("null"===(f=c.value).type)return[3,5];if("number"!==f.type)return[2,v];(void 0===i||f.data>i)&&(i=f.data),u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(c&&!c.done&&(a=o.return)))return[3,10];return[4,a.call(o)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,E(i)]}})})},H.max.arity=1,H.sum=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if(!(s=u.sent()).isArray())return[2,v];i=0,u.label=2;case 2:u.trys.push([2,7,8,13]),o=l(s),u.label=3;case 3:return[4,o.next()];case 4:if((c=u.sent()).done)return[3,6];if("null"===(f=c.value).type)return[3,5];if("number"!==f.type)return[2,v];i+=f.data,u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(c&&!c.done&&(a=o.return)))return[3,10];return[4,a.call(o)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,E(i)]}})})},H.sum.arity=1,H.avg=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f,p;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if(!(s=u.sent()).isArray())return[2,v];i=0,o=0,u.label=2;case 2:u.trys.push([2,7,8,13]),c=l(s),u.label=3;case 3:return[4,c.next()];case 4:if((f=u.sent()).done)return[3,6];if("null"===(p=f.value).type)return[3,5];if("number"!==p.type)return[2,v];i+=p.data,o++,u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(f&&!f.done&&(a=c.return)))return[3,10];return[4,a.call(c)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:if(0===o)return[2,v];return[2,E(i/o)]}})})},H.avg.arity=1;var R={global:U,string:V,array:D,pt:F,delta:$,diff:B,sanity:q,math:H};let Z=/^([\t\n\v\f\r \u0085\u00A0]|(\/\/[^\n]*\n))+/,z=/^\d+/,Q=/^[a-zA-Z_][a-zA-Z_0-9]*/;function W(e,t,r){let n,a,s=t,i=e[t];switch(i){case"+":{let u=W(e,K(e,t+1),10);if("error"===u.type)return u;n=[{name:"pos",position:s}].concat(u.marks),t=u.position;break}case"-":{let o=W(e,K(e,t+1),8);if("error"===o.type)return o;n=[{name:"neg",position:s}].concat(o.marks),t=o.position;break}case"(":{let c=W(e,K(e,t+1),0);if("error"===c.type)return c;switch(e[t=K(e,c.position)]){case",":for(n=[{name:"tuple",position:s}].concat(c.marks),t=K(e,t+1);;){if("error"===(c=W(e,t,0)).type)return c;if(","!==e[t=K(e,c.position)])break;t=K(e,t+1)}if(")"!==e[t])return{type:"error",position:t};t++,n.push({name:"tuple_end",position:t});break;case")":t++,n=[{name:"group",position:s}].concat(c.marks);break;default:return{type:"error",position:t}}break}case"!":{let l=W(e,K(e,t+1),10);if("error"===l.type)return l;n=[{name:"not",position:s}].concat(l.marks),t=l.position;break}case"{":{let f=Y(e,t);if("error"===f.type)return f;n=f.marks,t=f.position;break}case"[":if(n=[{name:"array",position:t}],"]"!==e[t=K(e,t+1)])for(;;){"..."===e.slice(t,t+3)&&(n.push({name:"array_splat",position:t}),t=K(e,t+3));let p=W(e,t,0);if("error"===p.type)return p;if(n=n.concat(p.marks),t=p.position,","!==e[t=K(e,t)]||"]"===e[t=K(e,t+1)])break}if("]"!==e[t])return{type:"error",position:t};t++,n.push({name:"array_end",position:t});break;case"'":case'"':{let h=function(e,t){let r=e[t];t+=1;let n=[{name:"str",position:t}];e:for(;;t++){if(t>e.length)return{type:"error",position:t};switch(e[t]){case r:n.push({name:"str_end",position:t}),t++;break e;case"\\":n.push({name:"str_pause",position:t}),"u"===e[t+1]?"{"===e[t+2]?(n.push({name:"unicode_hex",position:t+3}),t=e.indexOf("}",t+3),n.push({name:"unicode_hex_end",position:t})):(n.push({name:"unicode_hex",position:t+2}),n.push({name:"unicode_hex_end",position:t+6}),t+=5):(n.push({name:"single_escape",position:t+1}),t+=1),n.push({name:"str_start",position:t+1})}}return{type:"success",marks:n,position:t}}(e,t);if("error"===h.type)return h;n=h.marks,t=h.position;break}case"^":for(t++,n=[];"."===e[t]&&"^"===e[t+1];)n.push({name:"dblparent",position:s}),t+=2;n.push({name:"parent",position:s});break;case"@":n=[{name:"this",position:s}],t++;break;case"*":n=[{name:"everything",position:s}],t++;break;case"$":{let d=X(e,t+1,Q);d&&(t+=1+d,n=[{name:"param",position:s},{name:"ident",position:s+1},{name:"ident_end",position:t}]);break}default:{let y=X(e,t,z);if(y){let b="integer";if("."===e[t+=y]){let v=X(e,t+1,z);v&&(b="float",t+=1+v)}if("e"===e[t]||"E"===e[t]){b="sci",("+"===e[++t]||"-"===e[t])&&t++;let m=X(e,t,z);if(!m)return{type:"error",position:t};t+=m}n=[{name:b,position:s},{name:b+"_end",position:t}];break}let w=X(e,t,Q);if(w)switch(e[t+=w]){case":":case"(":{let g=L(e,s,t);if("error"===g.type)return g;n=g.marks,t=g.position;break}default:n=[{name:"this_attr",position:s},{name:"ident",position:s},{name:"ident_end",position:t}]}}}if(!n)return{type:"error",position:t};let k=12;t:for(;;){let x=K(e,t);if(x===e.length){t=x;break}if("success"===(a=J(e,x)).type){for(n.unshift({name:"traverse",position:s});"success"===a.type;)n=n.concat(a.marks),t=a.position,a=J(e,K(e,t));n.push({name:"traversal_end",position:t});continue}let _=e[x];switch(_){case"=":{let E=e[x+1];switch(E){case">":{if(r>1||k<=1)break t;let A=W(e,K(e,x+2),1);if("error"===A.type)return A;(n=n.concat(A.marks)).unshift({name:"pair",position:s}),t=A.position,k=1;break}case"=":{if(r>4||k<=4)break t;let S=W(e,K(e,x+2),5);if("error"===S.type)return S;n.unshift({name:"comp",position:s}),n.push({name:"op",position:x},{name:"op_end",position:x+2}),n=n.concat(S.marks),t=S.position,k=4;break}default:break t}break}case"+":{if(r>6||k<6)break t;let j=W(e,K(e,x+1),7);if("error"===j.type)return j;(n=n.concat(j.marks)).unshift({name:"add",position:s}),t=j.position,k=6;break}case"-":{if(r>6||k<6)break t;let O=W(e,K(e,x+1),7);if("error"===O.type)return O;(n=n.concat(O.marks)).unshift({name:"sub",position:s}),t=O.position,k=6;break}case"*":{if("*"===e[x+1]){if(r>8||k<=8)break t;let I=W(e,K(e,x+2),8);if("error"===I.type)return I;(n=n.concat(I.marks)).unshift({name:"pow",position:s}),t=I.position,k=8;break}if(r>7||k<7)break t;let C=W(e,K(e,x+1),8);if("error"===C.type)return C;(n=n.concat(C.marks)).unshift({name:"mul",position:s}),t=C.position,k=7;break}case"/":{if(r>7||k<7)break t;let T=W(e,K(e,x+1),8);if("error"===T.type)return T;(n=n.concat(T.marks)).unshift({name:"div",position:s}),t=T.position,k=7;break}case"%":{if(r>7||k<7)break t;let M=W(e,K(e,x+1),8);if("error"===M.type)return M;(n=n.concat(M.marks)).unshift({name:"mod",position:s}),t=M.position,k=7;break}case"<":case">":{if(r>4||k<=4)break t;let P=x+1;"="===e[P]&&P++;let N=W(e,K(e,P),5);if("error"===N.type)return N;n.unshift({name:"comp",position:s}),n.push({name:"op",position:x},{name:"op_end",position:P}),n=n.concat(N.marks),t=N.position,k=4;break}case"|":if("|"===e[x+1]){if(r>2||k<2)break t;let U=W(e,K(e,x+2),3);if("error"===U.type)return U;(n=n.concat(U.marks)).unshift({name:"or",position:s}),t=U.position,k=2}else{if(r>11||k<11)break t;let V=K(e,x+1),D=X(e,V,Q);if(!D)return{type:"error",position:V};if("("===e[t=V+D]||":"===e[t]){let F=L(e,V,t);if("error"===F.type)return F;(n=n.concat(F.marks)).unshift({name:"pipecall",position:s}),t=F.position,k=11}}break;case"&":{if("&"!=e[x+1]||r>3||k<3)break t;let q=W(e,K(e,x+2),4);if("error"===q.type)return q;(n=n.concat(q.marks)).unshift({name:"and",position:s}),t=q.position,k=3;break}case"!":{if("="!==e[x+1]||r>4||k<4)break t;let G=W(e,K(e,x+2),5);if("error"===G.type)return G;n.unshift({name:"comp",position:s}),n.push({name:"op",position:x},{name:"op_end",position:x+2}),n=n.concat(G.marks),t=G.position,k=4;break}case"d":if("desc"!==e.slice(x,x+4)||r>4||k<4)break t;n.unshift({name:"desc",position:s}),t=x+4,k=4;break;case"a":if("asc"!==e.slice(x,x+3)||r>4||k<4)break t;n.unshift({name:"asc",position:s}),t=x+3,k=4;break;default:{let $=function(e,t,r){let n=r.exec(e.slice(t));return n?n[0]:null}(e,x,Q);switch($){case"in":{if(r>4||k<=4)break t;t=K(e,x+2);let B=!1;"("===e[t]&&(B=!0,t=K(e,t+1));let H=t,R=W(e,t,5);if("error"===R.type)return R;if("."===e[t=K(e,R.position)]&&"."===e[t+1]){let Z="inc_range";"."===e[t+2]?(Z="exc_range",t=K(e,t+3)):t=K(e,t+2);let ee=W(e,t,5);if("error"===ee.type)return ee;n.unshift({name:"in_range",position:s}),n=n.concat({name:Z,position:H},R.marks,ee.marks),t=ee.position}else n.unshift({name:"comp",position:s}),n.push({name:"op",position:x},{name:"op_end",position:x+2}),n=n.concat(R.marks);if(B){if(")"!==e[t=K(e,t)])return{type:"error",position:t};t++}k=4;break}case"match":{if(r>4||k<=4)break t;let et=W(e,K(e,x+5),5);if("error"===et.type)return et;n.unshift({name:"comp",position:s}),n.push({name:"op",position:x},{name:"op_end",position:x+5}),n=n.concat(et.marks),t=et.position,k=4;break}default:break t}}}}let er=a?.type==="error"&&a.position;return{type:"success",marks:n,position:t,failPosition:er}}function J(e,t){let r=t;switch(e[t]){case".":{let n=t=K(e,t+1),a=X(e,t,Q);if(!a)return{type:"error",position:t};return{type:"success",marks:[{name:"attr_access",position:r},{name:"ident",position:n},{name:"ident_end",position:t+=a}],position:t}}case"-":if(">"!==e[t+1])break;let s=[{name:"deref",position:r}],i=K(e,t+=2),u=X(e,i,Q);return u&&(t=i+u,s.push({name:"deref_attr",position:i},{name:"ident",position:i},{name:"ident_end",position:t})),{type:"success",marks:s,position:t};case"[":{if("]"===e[t=K(e,t+1)])return{type:"success",marks:[{name:"array_postfix",position:r}],position:t+1};let o=t,c=W(e,t,0);if("error"===c.type)return c;if("."===e[t=K(e,c.position)]&&"."===e[t+1]){let l="inc_range";"."===e[t+2]?(l="exc_range",t+=3):t+=2,t=K(e,t);let f=W(e,t,0);if("error"===f.type)return f;if("]"!==e[t=K(e,f.position)])return{type:"error",position:t};return{type:"success",marks:[{name:"slice",position:r},{name:l,position:o}].concat(c.marks,f.marks),position:t+1}}if("]"!==e[t])return{type:"error",position:t};return{type:"success",marks:[{name:"square_bracket",position:r}].concat(c.marks),position:t+1}}case"|":if("{"===e[t=K(e,t+1)]){let p=Y(e,t);if("error"===p.type)return p;return p.marks.unshift({name:"projection",position:r}),p}break;case"{":{let h=Y(e,t);if("error"===h.type)return h;return h.marks.unshift({name:"projection",position:r}),h}}return{type:"error",position:t}}function L(e,t,r){let n=[];if(n.push({name:"func_call",position:t}),":"===e[r]&&":"===e[r+1]){n.push({name:"namespace",position:t}),n.push({name:"ident",position:t},{name:"ident_end",position:r}),r=K(e,r+2);let a=X(e,r,Q);if(!a||(n.push({name:"ident",position:r},{name:"ident_end",position:r+a}),"("!==e[r=K(e,r+a)]))return{type:"error",position:r};r++}else n.push({name:"ident",position:t},{name:"ident_end",position:r}),r=K(e,r+1);let s=r;if(")"!==e[r])for(;;){let i=W(e,r,0);if("error"===i.type)return i;if(n=n.concat(i.marks),s=i.position,","!==e[r=K(e,i.position)]||")"===e[r=K(e,r+1)])break}return")"!==e[r]?{type:"error",position:r}:(n.push({name:"func_args_end",position:s}),{type:"success",marks:n,position:r+1})}function Y(e,t){let r=[{name:"object",position:t}];for(t=K(e,t+1);"}"!==e[t];){let n=t;if("..."===e.slice(t,t+3)){if("}"!==e[t=K(e,t+3)]&&","!==e[t]){let a=W(e,t,0);if("error"===a.type)return a;r.push({name:"object_splat",position:n}),r=r.concat(a.marks),t=a.position}else r.push({name:"object_splat_this",position:n})}else{let s=W(e,t,0);if("error"===s.type)return s;let i=K(e,s.position);if("str"===s.marks[0].name&&":"===e[i]){let u=W(e,K(e,i+1),0);if("error"===u.type)return u;r.push({name:"object_pair",position:n}),r=r.concat(s.marks,u.marks),t=u.position}else r=r.concat({name:"object_expr",position:t},s.marks),t=s.position}if(","!==e[t=K(e,t)])break;t=K(e,t+1)}return"}"!==e[t]?{type:"error",position:t}:(t++,r.push({name:"object_end",position:t}),{type:"success",marks:r,position:t})}function K(e,t){return t+X(e,t,Z)}function X(e,t,r){let n=r.exec(e.slice(t));return n?n[0].length:0}function ee(e,t){return function(r){return t(e(r))}}function et(e){return function(t){return{type:"Map",base:t,expr:e({type:"This"})}}}function er(e,t){if(!t)return{type:"a-a",build:e};switch(t.type){case"a-a":return{type:"a-a",build:ee(e,t.build)};case"a-b":return{type:"a-b",build:ee(e,t.build)};case"b-b":return{type:"a-a",build:ee(e,et(t.build))};case"b-a":var r;return{type:"a-a",build:ee(e,(r=t.build,function(e){return{type:"FlatMap",base:e,expr:r({type:"This"})}}))};default:throw Error("unknown type: ".concat(t.type))}}function en(e,t){if(!t)return{type:"b-b",build:e};switch(t.type){case"a-a":case"b-a":return{type:"b-a",build:ee(e,t.build)};case"a-b":case"b-b":return{type:"b-b",build:ee(e,t.build)};default:throw Error("unknown type: ".concat(t.type))}}var ea={"==":function(e,t){return("string"===e.type&&"string"===t.type||"boolean"===e.type&&"boolean"===t.type||"null"===e.type&&"null"===t.type||"number"===e.type&&"number"===t.type?e.data===t.data:"datetime"===e.type&&"datetime"===t.type&&e.data.equals(t.data))?m:w},"!=":function(e,t){return equality(e,t)?w:m},">":function(e,t){if("stream"===e.type||"stream"===t.type)return v;var r=j(e.data,t.data);return null===r?v:r>0?m:w},">=":function(e,t){if("stream"===e.type||"stream"===t.type)return v;var r=j(e.data,t.data);return null===r?v:r>=0?m:w},"<":function(e,t){if("stream"===e.type||"stream"===t.type)return v;var r=j(e.data,t.data);return null===r?v:r<0?m:w},"<=":function(e,t){if("stream"===e.type||"stream"===t.type)return v;var r=j(e.data,t.data);return null===r?v:r<=0?m:w},in:function(e,t){var r,n,a,s;return i(this,void 0,void 0,function(){return u(this,function(i){switch(i.label){case 0:if("path"===t.type){if("string"!==e.type)return[2,v];return[2,t.data.matches(e.data)?m:w]}if(!t.isArray())return[3,13];i.label=1;case 1:i.trys.push([1,6,7,12]),r=l(t),i.label=2;case 2:return[4,r.next()];case 3:if((n=i.sent()).done)return[3,5];if(equality(e,n.value))return[2,m];i.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return a={error:i.sent()},[3,12];case 7:if(i.trys.push([7,,10,11]),!(n&&!n.done&&(s=r.return)))return[3,9];return[4,s.call(r)];case 8:i.sent(),i.label=9;case 9:return[3,11];case 10:if(a)throw a.error;return[7];case 11:return[7];case 12:return[2,w];case 13:return[2,v]}})})},match:function(e,t){return i(this,void 0,void 0,function(){var r,n;return u(this,function(a){switch(a.label){case 0:return r=[],n=[],[4,P(e,function(e){r=r.concat(T(e))})];case 1:return a.sent(),[4,P(t,function(e){n=n.concat(M(e).map(function(e){return function(t){return t.some(function(t){return e.test(t)})}}))})];case 2:var s,i;if(!a.sent())return[2,w];return s=r,i=n,[2,0!==s.length&&0!==i.length&&i.every(function(e){return e(s)})?m:w]}})})},"+":function(e,t){return"datetime"===e.type&&"number"===t.type?_(e.data.add(t.data)):"number"===e.type&&"number"===t.type?k(e.data+t.data):"string"===e.type&&"string"===t.type?x(e.data+t.data):"object"===e.type&&"object"===t.type?E(s(s({},e.data),t.data)):"array"===e.type&&"array"===t.type?E(e.data.concat(t.data)):e.isArray()&&t.isArray()?new y(function(){return c(this,arguments,function(){var r,n,a,s,i,c,f,p;return u(this,function(u){switch(u.label){case 0:u.trys.push([0,7,8,13]),r=l(e),u.label=1;case 1:return[4,o(r.next())];case 2:if((n=u.sent()).done)return[3,6];return[4,o(n.value)];case 3:return[4,u.sent()];case 4:u.sent(),u.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return i={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(n&&!n.done&&(c=r.return)))return[3,10];return[4,o(c.call(r))];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(i)throw i.error;return[7];case 12:return[7];case 13:u.trys.push([13,20,21,26]),a=l(t),u.label=14;case 14:return[4,o(a.next())];case 15:if((s=u.sent()).done)return[3,19];return[4,o(s.value)];case 16:return[4,u.sent()];case 17:u.sent(),u.label=18;case 18:return[3,14];case 19:return[3,26];case 20:return f={error:u.sent()},[3,26];case 21:if(u.trys.push([21,,24,25]),!(s&&!s.done&&(p=a.return)))return[3,23];return[4,o(p.call(a))];case 22:u.sent(),u.label=23;case 23:return[3,25];case 24:if(f)throw f.error;return[7];case 25:return[7];case 26:return[2]}})})}):v},"-":function(e,t){return"datetime"===e.type&&"number"===t.type?_(e.data.add(-t.data)):"datetime"===e.type&&"datetime"===t.type?k(e.data.difference(t.data)):"number"===e.type&&"number"===t.type?k(e.data-t.data):v},"*":es(function(e,t){return e*t}),"/":es(function(e,t){return e/t}),"%":es(function(e,t){return e%t}),"**":es(function(e,t){return Math.pow(e,t)})};function es(e){return function(t,r){return"number"===t.type&&"number"===r.type?k(e(t.data,r.data)):v}}var ei=function(){function e(e,t,r,n,a){this.isHidden=!1,this.params=e,this.source=t,this.value=r,this.context=n,this.parent=a}return e.prototype.createNested=function(t){return this.isHidden?new e(this.params,this.source,t,this.context,this.parent):new e(this.params,this.source,t,this.context,this)},e.prototype.createHidden=function(e){var t=this.createNested(e);return t.isHidden=!0,t},e}();function eu(e,t,r){return void 0===r&&(r=eu),(0,ec[e.type])(e,t,r)}function eo(e,t){return"then"in e?e.then(t):t(e)}var ec={This:function(e,t){return t.value},Selector:function(){throw Error("Selectors can not be evaluated")},Everything:function(e,t){return t.source},Parameter:function(e,t){var r=e.name;return E(t.params[r])},Context:function(e,t){var r=e.key;if("before"===r||"after"===r)return t.context[r]||v;throw Error("unknown context key: ".concat(r))},Parent:function(e,t){for(var r=e.n,n=t,a=0;a<r;a++){if(!n.parent)return v;n=n.parent}return n.value},OpCall:function(e,t,r){var n=e.op,a=e.left,s=e.right,o=ea[n];if(!o)throw Error("Unknown operator: ".concat(n));var c=r(a,t),l=r(s,t);return"then"in c||"then"in l?i(this,void 0,void 0,function(){var e,t;return u(this,function(r){switch(r.label){case 0:return e=o,[4,c];case 1:return t=[r.sent()],[4,l];case 2:return[2,e.apply(void 0,t.concat([r.sent()]))]}})}):o(c,l)},Select:function(e,t,r){var n=e.alternatives,a=e.fallback;return i(this,void 0,void 0,function(){var e,s,i,o;return u(this,function(u){switch(u.label){case 0:e=0,s=n,u.label=1;case 1:if(!(e<s.length))return[3,4];return[4,r((i=s[e]).condition,t)];case 2:if("boolean"===(o=u.sent()).type&&!0===o.data)return[2,r(i.value,t)];u.label=3;case 3:return e++,[3,1];case 4:if(a)return[2,r(a,t)];return[2,v]}})})},InRange:function(e,t,r){var n=e.base,a=e.left,s=e.right,o=e.isInclusive;return i(this,void 0,void 0,function(){var e,i,c,l,f,p,h,d,y;return u(this,function(u){switch(u.label){case 0:return[4,r(n,t)];case 1:return e=u.sent(),[4,r(a,t)];case 2:return i=u.sent(),[4,r(s,t)];case 3:return c=u.sent(),f=j,[4,e.get()];case 4:return p=[u.sent()],[4,i.get()];case 5:if(null===(l=f.apply(void 0,p.concat([u.sent()]))))return[2,v];return d=j,[4,e.get()];case 6:return y=[u.sent()],[4,c.get()];case 7:if(null===(h=d.apply(void 0,y.concat([u.sent()]))))return[2,v];if(o)return[2,l>=0&&h<=0?m:w];return[2,l>=0&&h<0?m:w]}})})},Filter:function(e,t,r){var n=e.base,a=e.expr;return i(this,void 0,void 0,function(){var e;return u(this,function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:if(!(e=s.sent()).isArray())return[2,v];return[2,new y(function(){return c(this,arguments,function(){var n,s,i,c,f,p;return u(this,function(u){switch(u.label){case 0:u.trys.push([0,8,9,14]),n=l(e),u.label=1;case 1:return[4,o(n.next())];case 2:if((s=u.sent()).done)return[3,7];return i=s.value,[4,o(r(a,t.createNested(i)))];case 3:if(!("boolean"===(c=u.sent()).type&&!0===c.data))return[3,6];return[4,o(i)];case 4:return[4,u.sent()];case 5:u.sent(),u.label=6;case 6:return[3,1];case 7:return[3,14];case 8:return f={error:u.sent()},[3,14];case 9:if(u.trys.push([9,,12,13]),!(s&&!s.done&&(p=n.return)))return[3,11];return[4,o(p.call(n))];case 10:u.sent(),u.label=11;case 11:return[3,13];case 12:if(f)throw f.error;return[7];case 13:return[7];case 14:return[2]}})})})]}})})},Projection:function(e,t,r){var n=e.base,a=e.expr;return i(this,void 0,void 0,function(){var e;return u(this,function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:if("object"!==(e=s.sent()).type)return[2,v];return[2,r(a,t.createNested(e))]}})})},FuncCall:function(e,t,r){return(0,e.func)(e.args,t,r)},PipeFuncCall:function(e,t,r){var n=e.func,a=e.base,s=e.args;return i(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:return[4,r(a,t)];case 1:return[2,n(e.sent(),s,t,r)]}})})},AccessAttribute:function(e,t,r){var n=e.base,a=e.name;return i(this,void 0,void 0,function(){var e;return u(this,function(s){switch(s.label){case 0:if(e=t.value,!n)return[3,2];return[4,r(n,t)];case 1:e=s.sent(),s.label=2;case 2:if("object"===e.type&&e.data.hasOwnProperty(a))return[2,E(e.data[a])];return[2,v]}})})},AccessElement:function(e,t,r){var n=e.base,a=e.index;return i(this,void 0,void 0,function(){var e,s;return u(this,function(i){switch(i.label){case 0:return[4,r(n,t)];case 1:if(!(e=i.sent()).isArray())return[2,v];return[4,e.get()];case 2:return[2,E((s=i.sent())[a<0?a+s.length:a])]}})})},Slice:function(e,t,r){var n=e.base,a=e.left,s=e.right,o=e.isInclusive;return i(this,void 0,void 0,function(){var e,i,c,l;return u(this,function(u){switch(u.label){case 0:return[4,r(n,t)];case 1:if(!(e=u.sent()).isArray())return[2,v];return[4,e.get()];case 2:return i=u.sent(),c=a,l=s,c<0&&(c=i.length+c),l<0&&(l=i.length+l),o&&l++,c<0&&(c=0),l<0&&(l=0),[2,E(i.slice(c,l))]}})})},Deref:function(e,t,r){var n,a,s=e.base;return i(this,void 0,void 0,function(){var e,i,o,c,f;return u(this,function(u){switch(u.label){case 0:return[4,r(s,t)];case 1:if(e=u.sent(),!t.source.isArray()||"object"!==e.type||"string"!=typeof(i=e.data._ref))return[2,v];u.label=2;case 2:u.trys.push([2,7,8,13]),o=l(t.source),u.label=3;case 3:return[4,o.next()];case 4:if((c=u.sent()).done)return[3,6];if("object"===(f=c.value).type&&i===f.data._id)return[2,f];u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(c&&!c.done&&(a=o.return)))return[3,10];return[4,a.call(o)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,v]}})})},Value:function(e){return E(e.value)},Group:function(e,t,r){return r(e.base,t)},Object:function(e,t,r){var n=e.attributes;return i(this,void 0,void 0,function(){var e,a,s,i,o,c,l,f,p,h;return u(this,function(u){switch(u.label){case 0:e={},a=0,s=n,u.label=1;case 1:if(!(a<s.length))return[3,12];switch(o=(i=s[a]).type,i.type){case"ObjectAttributeValue":return[3,2];case"ObjectConditionalSplat":return[3,5];case"ObjectSplat":return[3,8]}return[3,10];case 2:case 8:return[4,r(i.value,t)];case 3:return l=u.sent(),f=e,p=i.name,[4,l.get()];case 4:return f[p]=u.sent(),[3,11];case 5:return[4,r(i.condition,t)];case 6:if("boolean"!==(h=u.sent()).type||!1===h.data)return[3,11];return[4,r(i.value,t)];case 7:case 9:return"object"===(l=u.sent()).type&&Object.assign(e,l.data),[3,11];case 10:throw Error("Unknown node type: ".concat(o));case 11:return a++,[3,1];case 12:return[2,E(e)]}})})},Array:function(e,t,r){var n=e.elements;return new y(function(){return c(this,arguments,function(){var e,a,s,i,c,f,p,h;return u(this,function(u){switch(u.label){case 0:e=0,a=n,u.label=1;case 1:if(!(e<a.length))return[3,21];return[4,o(r((s=a[e]).value,t))];case 2:if(i=u.sent(),!s.isSplat)return[3,17];if(!i.isArray())return[3,16];u.label=3;case 3:u.trys.push([3,10,11,16]),p=void 0,c=l(i),u.label=4;case 4:return[4,o(c.next())];case 5:if((f=u.sent()).done)return[3,9];return[4,o(f.value)];case 6:return[4,u.sent()];case 7:u.sent(),u.label=8;case 8:return[3,4];case 9:return[3,16];case 10:return p={error:u.sent()},[3,16];case 11:if(u.trys.push([11,,14,15]),!(f&&!f.done&&(h=c.return)))return[3,13];return[4,o(h.call(c))];case 12:u.sent(),u.label=13;case 13:return[3,15];case 14:if(p)throw p.error;return[7];case 15:return[7];case 16:return[3,20];case 17:return[4,o(i)];case 18:return[4,u.sent()];case 19:u.sent(),u.label=20;case 20:return e++,[3,1];case 21:return[2]}})})})},Tuple:function(){throw Error("tuples can not be evaluated")},Or:function(e,t,r){var n=e.left,a=e.right;return i(this,void 0,void 0,function(){var e,s;return u(this,function(i){switch(i.label){case 0:return[4,r(n,t)];case 1:return e=i.sent(),[4,r(a,t)];case 2:if(s=i.sent(),"boolean"===e.type&&!0===e.data||"boolean"===s.type&&!0===s.data)return[2,m];if("boolean"!==e.type||"boolean"!==s.type)return[2,v];return[2,w]}})})},And:function(e,t,r){var n=e.left,a=e.right;return i(this,void 0,void 0,function(){var e,s;return u(this,function(i){switch(i.label){case 0:return[4,r(n,t)];case 1:return e=i.sent(),[4,r(a,t)];case 2:if(s=i.sent(),"boolean"===e.type&&!1===e.data||"boolean"===s.type&&!1===s.data)return[2,w];if("boolean"!==e.type||"boolean"!==s.type)return[2,v];return[2,m]}})})},Not:function(e,t,r){var n=e.base;return i(this,void 0,void 0,function(){var e;return u(this,function(a){switch(a.label){case 0:return[4,r(n,t)];case 1:if("boolean"!==(e=a.sent()).type)return[2,v];return[2,e.data?w:m]}})})},Neg:function(e,t,r){return eo(r(e.base,t),function(e){return"number"!==e.type?v:k(-e.data)})},Pos:function(e,t,r){return eo(r(e.base,t),function(e){return"number"!==e.type?v:k(e.data)})},Asc:function(){return v},Desc:function(){return v},ArrayCoerce:function(e,t,r){var n=e.base;return i(this,void 0,void 0,function(){var e;return u(this,function(a){switch(a.label){case 0:return[4,r(n,t)];case 1:return[2,(e=a.sent()).isArray()?e:v]}})})},Map:function(e,t,r){var n=e.base,a=e.expr;return i(this,void 0,void 0,function(){var e;return u(this,function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:if(!(e=s.sent()).isArray())return[2,v];return[2,new y(function(){return c(this,arguments,function(){var n,s,i,c,f;return u(this,function(u){switch(u.label){case 0:u.trys.push([0,8,9,14]),n=l(e),u.label=1;case 1:return[4,o(n.next())];case 2:if((s=u.sent()).done)return[3,7];return i=s.value,[4,o(r(a,t.createHidden(i)))];case 3:return[4,o.apply(void 0,[u.sent()])];case 4:return[4,u.sent()];case 5:u.sent(),u.label=6;case 6:return[3,1];case 7:return[3,14];case 8:return c={error:u.sent()},[3,14];case 9:if(u.trys.push([9,,12,13]),!(s&&!s.done&&(f=n.return)))return[3,11];return[4,o(f.call(n))];case 10:u.sent(),u.label=11;case 11:return[3,13];case 12:if(c)throw c.error;return[7];case 13:return[7];case 14:return[2]}})})})]}})})},FlatMap:function(e,t,r){var n=e.base,a=e.expr;return i(this,void 0,void 0,function(){var e;return u(this,function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:if(!(e=s.sent()).isArray())return[2,v];return[2,new y(function(){return c(this,arguments,function(){var n,s,i,c,f,p,h,d,y,b;return u(this,function(u){switch(u.label){case 0:u.trys.push([0,23,24,29]),n=l(e),u.label=1;case 1:return[4,o(n.next())];case 2:if((s=u.sent()).done)return[3,22];return i=s.value,[4,o(r(a,t.createHidden(i)))];case 3:if(!(c=u.sent()).isArray())return[3,18];u.label=4;case 4:u.trys.push([4,11,12,17]),y=void 0,f=l(c),u.label=5;case 5:return[4,o(f.next())];case 6:if((p=u.sent()).done)return[3,10];return[4,o(p.value)];case 7:return[4,u.sent()];case 8:u.sent(),u.label=9;case 9:return[3,5];case 10:return[3,17];case 11:return y={error:u.sent()},[3,17];case 12:if(u.trys.push([12,,15,16]),!(p&&!p.done&&(b=f.return)))return[3,14];return[4,o(b.call(f))];case 13:u.sent(),u.label=14;case 14:return[3,16];case 15:if(y)throw y.error;return[7];case 16:return[7];case 17:return[3,21];case 18:return[4,o(c)];case 19:return[4,u.sent()];case 20:u.sent(),u.label=21;case 21:return[3,1];case 22:return[3,29];case 23:return h={error:u.sent()},[3,29];case 24:if(u.trys.push([24,,27,28]),!(s&&!s.done&&(d=n.return)))return[3,26];return[4,o(d.call(n))];case 25:u.sent(),u.label=26;case 26:return[3,28];case 27:if(h)throw h.error;return[7];case 28:return[7];case 29:return[2]}})})})]}})})}};function el(e,t){void 0===t&&(t={});var r=E(t.root),n=E(t.dataset),a=s({},t.params);return eu(e,new ei(a,n,r,{timestamp:t.timestamp||new Date,identity:void 0===t.identity?"me":t.identity,sanity:t.sanity,after:t.after?E(t.after):null,before:t.before?E(t.before):null},null))}var ef=new ei({},v,v,{timestamp:new Date(0),identity:"me",before:null,after:null},null);function ep(e){return!function e(t){switch(t.type){case"Group":case"Value":case"Parameter":return!0;case"Pos":case"Neg":return e(t.base);case"OpCall":switch(t.op){case"+":case"-":case"*":case"/":case"%":case"**":return e(t.left)&&e(t.right);default:return!1}default:return!1}}(e)?null:function e(t){var r=eu(t,ef,e);if("then"in r)throw Error("BUG: constant evaluate should never return a promise");return r}(e)}var eh={"'":"'",'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},ed=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="GroqQueryError",t}return a(t,e),t}(Error),ey={group:function(e){return{type:"Group",base:e.process(ey)}},everything:function(){return{type:"Everything"}},this:function(){return{type:"This"}},parent:function(){return{type:"Parent",n:1}},dblparent:function(e){return{type:"Parent",n:e.process(ey).n+1}},traverse:function(e){for(var t=e.process(ey),r=[];"traversal_end"!==e.getMark().name;)r.push(e.process(ev));e.shift();for(var n=null,a=r.length-1;a>=0;a--)n=r[a](n);if(("Everything"===t.type||"Array"===t.type||"PipeFuncCall"===t.type)&&(n=er(function(e){return e},n)),null===n)throw Error("BUG: unexpected empty traversal");return n.build(t)},this_attr:function(e){var t=e.processString();return"null"===t?{type:"Value",value:null}:"true"===t?{type:"Value",value:!0}:"false"===t?{type:"Value",value:!1}:{type:"AccessAttribute",name:t}},neg:function(e){return{type:"Neg",base:e.process(ey)}},pos:function(e){return{type:"Pos",base:e.process(ey)}},add:function(e){return{type:"OpCall",op:"+",left:e.process(ey),right:e.process(ey)}},sub:function(e){return{type:"OpCall",op:"-",left:e.process(ey),right:e.process(ey)}},mul:function(e){return{type:"OpCall",op:"*",left:e.process(ey),right:e.process(ey)}},div:function(e){return{type:"OpCall",op:"/",left:e.process(ey),right:e.process(ey)}},mod:function(e){return{type:"OpCall",op:"%",left:e.process(ey),right:e.process(ey)}},pow:function(e){return{type:"OpCall",op:"**",left:e.process(ey),right:e.process(ey)}},comp:function(e){var t=e.process(ey);return{type:"OpCall",op:e.processString(),left:t,right:e.process(ey)}},in_range:function(e){var t=e.process(ey),r="inc_range"===e.getMark().name;return e.shift(),{type:"InRange",base:t,left:e.process(ey),right:e.process(ey),isInclusive:r}},str:function(e){var t="";t:for(;e.hasMark();){var r=e.getMark();switch(r.name){case"str_end":t+=e.processStringEnd();break t;case"str_pause":t+=e.processStringEnd();break;case"str_start":e.shift();break;case"single_escape":var n=e.slice(1);e.shift(),t+=eh[n];break;case"unicode_hex":e.shift(),t+=String.fromCharCode(parseInt(e.processStringEnd(),16));break;default:throw Error("unexpected mark: ".concat(r.name))}}return{type:"Value",value:t}},integer:function(e){return{type:"Value",value:Number(e.processStringEnd())}},float:function(e){return{type:"Value",value:Number(e.processStringEnd())}},sci:function(e){return{type:"Value",value:Number(e.processStringEnd())}},object:function(e){for(var t=[];"object_end"!==e.getMark().name;)t.push(e.process(eb));return e.shift(),{type:"Object",attributes:t}},array:function(e){for(var t=[];"array_end"!==e.getMark().name;){var r=!1;"array_splat"===e.getMark().name&&(r=!0,e.shift());var n=e.process(ey);t.push({type:"ArrayElement",value:n,isSplat:r})}return e.shift(),{type:"Array",elements:t}},tuple:function(e){for(var t=[];"tuple_end"!==e.getMark().name;)t.push(e.process(ey));return e.shift(),{type:"Tuple",members:t}},func_call:function(e){var t,r,n="global";"namespace"===e.getMark().name&&(e.shift(),n=e.processString());var a=e.processString();if("global"===n&&"select"===a){for(var s={type:"Select",alternatives:[]};"func_args_end"!==e.getMark().name;)if("pair"===e.getMark().name){if(s.fallback)throw new ed("unexpected argument to select()");e.shift();var i=e.process(ey),u=e.process(ey);s.alternatives.push({type:"SelectAlternative",condition:i,value:u})}else{if(s.fallback)throw new ed("unexpected argument to select()");var u=e.process(ey);s.fallback=u}return e.shift(),s}for(var o=[];"func_args_end"!==e.getMark().name;)(t=n,r=o.length,"diff"==t&&2==r&&["changedAny","changedOnly"].includes(a))?(e.process(em),o.push({type:"Selector"})):o.push(e.process(ey));if(e.shift(),"global"===n&&("before"===a||"after"===a)&&"delta"===e.parseOptions.mode)return{type:"Context",key:a};if("global"===n&&"boost"===a&&!e.allowBoost)throw new ed("unexpected boost");var c=R[n];if(!c)throw new ed("Undefined namespace: ".concat(n));var l=c[a];if(!l||(void 0!==l.arity&&ew(a,l.arity,o.length),void 0!==l.mode&&l.mode!==e.parseOptions.mode))throw new ed("Undefined function: ".concat(a));return{type:"FuncCall",func:l,name:a,args:o}},pipecall:function(e){var t=e.process(ey);e.shift();var r="global";if("namespace"===e.getMark().name&&(e.shift(),r=e.processString()),"global"!==r)throw new ed("Undefined namespace: ".concat(r));var n=e.processString(),a=[],s=e.allowBoost;for("score"===n&&(e.allowBoost=!0);;){var i=e.getMark().name;if("func_args_end"===i)break;if("order"===n){if("asc"===i){e.shift(),a.push({type:"Asc",base:e.process(ey)});continue}if("desc"===i){e.shift(),a.push({type:"Desc",base:e.process(ey)});continue}}a.push(e.process(ey))}e.shift(),e.allowBoost=s;var u=G[n];if(!u)throw new ed("Undefined pipe function: ".concat(n));return u.arity&&ew(n,u.arity,a.length),{type:"PipeFuncCall",func:u,base:t,name:n,args:a}},pair:function(e){throw new ed("unexpected =>")},and:function(e){return{type:"And",left:e.process(ey),right:e.process(ey)}},or:function(e){return{type:"Or",left:e.process(ey),right:e.process(ey)}},not:function(e){return{type:"Not",base:e.process(ey)}},asc:function(e){throw new ed("unexpected asc")},desc:function(e){throw new ed("unexpected desc")},param:function(e){var t=e.processString();return e.parseOptions.params&&e.parseOptions.params.hasOwnProperty(t)?{type:"Value",value:e.parseOptions.params[t]}:{type:"Parameter",name:t}}},eb={object_expr:function(e){if("pair"===e.getMark().name)return e.shift(),{type:"ObjectConditionalSplat",condition:e.process(ey),value:e.process(ey)};var t=e.process(ey);return{type:"ObjectAttributeValue",name:function e(t){if("AccessAttribute"===t.type&&!t.base)return t.name;if("Deref"===t.type||"Map"===t.type||"Projection"===t.type||"Slice"===t.type||"Filter"===t.type||"AccessElement"===t.type||"ArrayCoerce"===t.type)return e(t.base);throw new ed("Cannot determine property key for type: ".concat(t.type))}(t),value:t}},object_pair:function(e){var t=e.process(ey);if("Value"!==t.type)throw Error("name must be string");var r=e.process(ey);return{type:"ObjectAttributeValue",name:t.value,value:r}},object_splat:function(e){return{type:"ObjectSplat",value:e.process(ey)}},object_splat_this:function(){return{type:"ObjectSplat",value:{type:"This"}}}},ev={square_bracket:function(e){var t=e.process(ey),r=ep(t);return r&&"number"===r.type?function(e){return function(e,t){if(!t)return{type:"a-b",build:e};switch(t.type){case"a-a":case"b-a":return{type:"a-a",build:ee(e,t.build)};case"a-b":case"b-b":return{type:"a-b",build:ee(e,t.build)};default:throw Error("unknown type: ".concat(t.type))}}(function(e){return{type:"AccessElement",base:e,index:r.data}},e)}:r&&"string"===r.type?function(e){return en(function(e){return{type:"AccessAttribute",base:e,name:r.data}},e)}:function(e){return er(function(e){return{type:"Filter",base:e,expr:t}},e)}},slice:function(e){var t="inc_range"===e.getMark().name;e.shift();var r=e.process(ey),n=e.process(ey),a=ep(r),s=ep(n);if(!a||!s||"number"!==a.type||"number"!==s.type)throw new ed("slicing must use constant numbers");return function(e){return er(function(e){return{type:"Slice",base:e,left:a.data,right:s.data,isInclusive:t}},e)}},projection:function(e){var t=e.process(ey);return function(e){return function(e,t){if(!t)return{type:"b-b",build:e};switch(t.type){case"a-a":return{type:"a-a",build:ee(et(e),t.build)};case"a-b":return{type:"a-b",build:ee(et(e),t.build)};case"b-a":return{type:"b-a",build:ee(e,t.build)};case"b-b":return{type:"b-b",build:ee(e,t.build)};default:throw Error("unknown type: ".concat(t.type))}}(function(e){return{type:"Projection",base:e,expr:t}},e)}},attr_access:function(e){var t=e.processString();return function(e){return en(function(e){return{type:"AccessAttribute",base:e,name:t}},e)}},deref:function(e){var t=null;return"deref_attr"===e.getMark().name&&(e.shift(),t=e.processString()),function(e){return en(function(e){var r;return r={type:"Deref",base:e},t?{type:"AccessAttribute",base:r,name:t}:r},e)}},array_postfix:function(e){return function(e){return er(function(e){return{type:"ArrayCoerce",base:e}},e)}}},em={group:function(e){return e.process(em),null},everything:function(){throw Error("Invalid selector syntax")},this:function(){throw Error("Invalid selector syntax")},parent:function(){throw Error("Invalid selector syntax")},dblparent:function(e){throw Error("Invalid selector syntax")},traverse:function(e){for(e.process(em);"traversal_end"!==e.getMark().name;)e.process(ev);return e.shift(),null},this_attr:function(e){return e.processString(),null},neg:function(e){throw Error("Invalid selector syntax")},pos:function(e){throw Error("Invalid selector syntax")},add:function(e){throw Error("Invalid selector syntax")},sub:function(e){throw Error("Invalid selector syntax")},mul:function(e){throw Error("Invalid selector syntax")},div:function(e){throw Error("Invalid selector syntax")},mod:function(e){throw Error("Invalid selector syntax")},pow:function(e){throw Error("Invalid selector syntax")},comp:function(e){throw Error("Invalid selector syntax")},in_range:function(e){throw Error("Invalid selector syntax")},str:function(e){throw Error("Invalid selector syntax")},integer:function(e){throw Error("Invalid selector syntax")},float:function(e){throw Error("Invalid selector syntax")},sci:function(e){throw Error("Invalid selector syntax")},object:function(e){throw Error("Invalid selector syntax")},array:function(e){throw Error("Invalid selector syntax")},tuple:function(e){throw Error("Invalid selector syntax")},func_call:function(e,t){var r=ey.func_call(e,t);if("anywhere"===r.name&&1===r.args.length)return null;throw Error("Invalid selector syntax")},pipecall:function(e){throw Error("Invalid selector syntax")},pair:function(e){throw Error("Invalid selector syntax")},and:function(e){throw Error("Invalid selector syntax")},or:function(e){throw Error("Invalid selector syntax")},not:function(e){throw Error("Invalid selector syntax")},asc:function(e){throw Error("Invalid selector syntax")},desc:function(e){throw Error("Invalid selector syntax")},param:function(e){throw Error("Invalid selector syntax")}};function ew(e,t,r){if("number"==typeof t){if(r!==t)throw new ed("Incorrect number of arguments to function ".concat(e,"(). Expected ").concat(t,", got ").concat(r,"."))}else if(t&&!t(r))throw new ed("Incorrect number of arguments to function ".concat(e,"()."))}var eg=function(e){function t(t){var r=e.call(this,"Syntax error in GROQ query at position ".concat(t))||this;return r.name="GroqSyntaxError",r.position=t,r}return a(t,e),t}(Error);function ek(e,t){let r,n;void 0===t&&(t={});var a=(r=0,r=K(e,0),"error"===(n=W(e,r,0)).type?n:(r=K(e,n.position))!==e.length?(n.failPosition&&(r=n.failPosition-1),{type:"error",position:r}):(delete n.position,delete n.failPosition,n));if("error"===a.type)throw new eg(a.position);return new f(e,a.marks,t).process(ey)}}}]);